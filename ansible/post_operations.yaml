---
- name: Post Operation on Ubuntu Server
  hosts: ubuntu
  become: yes
  tasks:
    
    - name: Remove update-motd files
      file:
        path: "/etc/update-motd.d/{{ item }}"
        state: absent
      with_items:
        - 00-header
        - 10-help-text
        - 50-motd-news
        - 50-landscape-sysinfo
        - 80-livepatch
        - 85-fwupd
        - 90-updates-available
        - 95-hwe-eol
        - 88-esm-announce
        - 91-release-upgrade
        - 92-unattended-upgrades
        - 98-fsck-at-reboot
        - 98-reboot-required
        - 97-overlayroot
        - 98-unattended-upgrades
    
    - name: Ensure MOTD file exists
      file:
        path: /etc/motd
        state: touch

    - name: Add custom message to MOTD file
      lineinfile:
        path: /etc/motd
        line: "–ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–¥ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ–º –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ GRILL (Government Reconnaissance of Infiltration, Larceny, and Lusciousness). –ù–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –±—É–¥–µ—Ç —Ä–∞—Å—Ü–µ–Ω–µ–Ω –∫–∞–∫ –ø–µ—Ä–µ–∂–∞—Ä–µ–Ω–Ω—ã–π —Å—Ç–µ–π–∫ - —Ç—â–∞—Ç–µ–ª—å–Ω–æ —Å–æ–∂–∂–µ–Ω. üî•ü•©
        ---
        0xE - vC0rp"
        insertafter: EOF

    - name: Ensure port 3100 is blocked (via ufw)
      ufw:
        rule: reject
        port: 3100

    - name: Configure rsyslog
      lineinfile:
        path: /etc/rsyslog.conf
        regexp: "^\\$SystemLogRateLimit"
        line: "$SystemLogRateLimitInterval 0"
        state: present
      notify:
        - restart rsyslog

  handlers:
    - name: restart rsyslog
      service:
        name: rsyslog
        state: restarted